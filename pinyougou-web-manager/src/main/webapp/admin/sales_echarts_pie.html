<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>后台管理系统</title>
</head>
<link rel="stylesheet" href="../plugins/bootstrap/css/bootstrap.min.css">
<link rel="stylesheet" href="../plugins/adminLTE/css/AdminLTE.css">
<link rel="stylesheet" href="../plugins/adminLTE/css/skins/_all-skins.min.css">
<link rel="stylesheet" href="../css/style.css">
<script src="../plugins/jQuery/jquery-2.2.3.min.js"></script>
<script src="../plugins/bootstrap/js/bootstrap.min.js"></script>

<!-- 引入angular的js -->
<script type="text/javascript" src="../plugins/angularjs/angular.min.js"></script>
<!-- 引入分页相关的JS和CSS -->
<script type="text/javascript" src="../plugins/angularjs/pagination.js"></script>
<link rel="stylesheet" href="../plugins/angularjs/pagination.css">

<script type="text/javascript" src="../js/base_pagination.js"></script>
<script type="text/javascript" src="../js/controller/baseController.js"></script>
<!--加载ECharts-->
<script src="../js/echart/echarts.js"></script>

<body class="hold-transition skin-blue sidebar-mini">
<!-- 内容区域 -->
﻿
<section class="content-header">
    <h1>
        今日商家销售饼状图
    </h1>
</section>
<section class="content">

    <div class="form-group" style="align:right">
        <div class="col-sm-6">
            <label for="date">选择日期</label>
            <input onchange="getDate()" value="2019-04-14" type="date" class="form-control" style="width: 220px;height: 30px"
                   name="selectdate">
        </div>
    </div>
</section>

<div id="main2" style="width: 1000px;height:800px;">

    <!-- 为ECharts准备一个具备大小（宽高）的Dom -->

    <script>
        var myChart = echarts.init(document.getElementById('main2'));

        option = {
            tooltip: {
                trigger: 'item',
                formatter: "{a} <br/>{b}: {c} ({d}%)"
            },
            legend: {
                orient: 'vertical',
                x: 'right',
                data: []
            },
            series: [
                {
                    name: '销售额',
                    type: 'pie',
                    radius: ['0%', '65%'],
                    label: {
                        normal: {
                            formatter: '{a|{a}}{abg|}\n{hr|}\n  {b|{b}：}{c}  {per|{d}%}  ',
                            backgroundColor: '#eee',
                            borderColor: '#aaa',
                            borderWidth: 1,
                            borderRadius: 4,
                            rich: {
                                a: {
                                    color: '#999',
                                    lineHeight: 22,
                                    align: 'center'
                                },
                                hr: {
                                    borderColor: '#aaa',
                                    width: '100%',
                                    borderWidth: 0.5,
                                    height: 0
                                },
                                b: {
                                    fontSize: 16,
                                    lineHeight: 33
                                },
                                per: {
                                    color: '#eee',
                                    backgroundColor: '#334455',
                                    padding: [2, 4],
                                    borderRadius: 2
                                }
                            }
                        }
                    },
                    data: []
                }
            ]
        };
        myChart.setOption(option);
        //date=2019-04-04
       $(function () {
           var today = new Date();
           var date1 = today.getFullYear() + '-' + (today.getMonth() + 1) + '-' + today.getDate();
           var mydateInput = document.getElementsByName("selectdate");
           mydateInput.value = date1;

           $.ajax({
               type: "get",
               url: "../sales/getSellerSales.do?date="+date1,
               cache: false,  //禁用缓存
               dataType: "json",
               success: function (response) {
                   //定义两个数组
                   var leg = [];
                   var arr=[];
                   $.each(response, function (index,result) {
                       leg.push(result.name)
                       arr.push({"value":result.value,"name":result.name})
                   });
                   myChart.setOption({ //加载数据图表
                       legend: {
                           data: leg
                       },
                       series: [
                           {
                               name: '销售额',
                               data: arr
                           }]
                   });
               },
               error: function (XMLHttpRequest, textStatus, errorThrown) {
                   alert("查询失败");
               }
           });

           $("[name='selectdate']").change(function () {
               date1 = $("[name='selectdate']").val();
               // alert(date1)
               //饼图动态赋值
               $.ajax({
                   type: "get",
                   url: "../sales/getSellerSales.do?date="+date1,
                   cache: false,  //禁用缓存
                   dataType: "json",
                   success: function (response) {
                       //定义两个数组
                       var leg = [];
                       var arr=[];
                       $.each(response, function (index,result) {
                               leg.push(result.name)
                               arr.push({"value":result.value,"name":result.name})
                       });
                       myChart.setOption({ //加载数据图表
                           legend: {
                               data: leg
                           },
                           series: [
                               {
                               name: '销售额',
                               data: arr
                           }]
                       });
                   },
                   error: function (XMLHttpRequest, textStatus, errorThrown) {
                       alert("查询失败");
                   }
               });
           })
       })


    </script>
</div>
</body>
</html>
